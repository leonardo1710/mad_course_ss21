
# 02 - Layouts and Data Binding


| findViewById | Data Binding | View Binding |
|--|--|--|
|Each time findViewById is used to access a view object, Android traverses the view hierarchy at runtime.| Layout is connected to activity or fragment at compile time. Helper class is generated by compiler (Binding class) when activity/fragment is created. | Once view binding is enabled in a module, it generates a binding class (like with Data Binding) for each XML layout file present in that module. An instance of a binding class contains direct references to all views that have an ID in the corresponding layout. |
| - Performance issues in large or deeply nested view hierarchies | - slower build time | - no binding of data to XML (layout variables) and no 2-way data binding |
| - not null safe (eg view is not available when calling) | + type and null safe (checked at compile time)|	+ type and null safe (checked at compile time) |
| + has no impact on build speed since it works at runtime| + performance gain for complex view hierarchies | + fast build time and no performance issues |
| + ease of use (only findViewById()) | - requires specially tagged XML layout files (<layout></layout>) | + once enabled, it applies to all of the module's layouts |
| Usage: should always be avoided | Usage: layouts that need advanced features (eg. dynamical data loading) | Usage: when no advanced features are needed in the view (should always replace findViewById()) |


# Data binding guide

1. **Enable data binding** in build.gradle(Module:app) file and sync the project (important!)

	> **Note:** Always sync project after editing build.gradle file!
	
	```kotlin
	//build.gradle(:app)
	buildFeatures {
		dataBinding true
	}
	```
2. **Use `<layout>` as root view** in your XML layout.

	Inside your_layout.xml (eg activity_main.xml) **wrap view hierarchy inside layout tags** and place the namespace declarations inside the tag

	```xml
<layout
	xmlns:android="http://schemas.android.com/apk/res/android"  
	xmlns:app="http://schemas.android.com/apk/res-auto"  
	xmlns:tools="http://schemas.android.com/tools"
>
	<LinearLayout>
		...
	</LinearLayout>
</layout>
	```

3. **Define a binding variable**

	In the activity file (eg MainActivity.kt) create a lateinit variable for the binding object that will be created during compilation:

	```kotlin
	import com.example.databindingexample.databinding.ActivityMainBinding

	class MainActivity : AppCompatActivity() {  
		//binding object variable
		private lateinit var binding: ActivityMainBinding
	}
	```

	> **Note:** The type of binding object always derives from the name of the layout XML file plus Binding: 
	
		Activity_main.xml -> ActivityMainBinding
		
		Your_layout.xml -> YourLayoutBinding

	> **Tip:** To fast import specific libraries in Android Studio hover the object and press <kbd>Alt + Enter</kbd>
	
4. **Instantiate the binding object** and **replace setContentView** 

	Replace setContentView() inside onCreate()-method with an instruction to create the binding object

	```kotlin
	override fun onCreate(savedInstanceState: Bundle?) {  
		super.onCreate(savedInstanceState)
		//instead of:  
		//setContentView(R.layout.activity_main)
		//generate binding object  
		binding = DataBindingUtil.setContentView(this, R.layout.activity_main) 
	}
	```

	> **Note:** Don't forget to import DataBindingUtil package 
	> ```kotlin 
	> import androidx.databinding.DataBindingUtil
	> ```

5. **Access view objects with binding**

	Now view objects can be accessed through binding object
	```kotlin 
	binding = DataBindingUtil.setContentView(this, R.layout.activity_main)  
	var myBtn = binding.clickBtn	//via id of button
	```

## Integrate Data Classes inside Layout
1. Create a data class in Kotlin
	```kotlin
	data class User (var username: String = "", var email: String = "")
	```

2. **Create a variable data block** in your XML layout

	Add a data block inside the layout.xml file which contains a variable of your data class:
		
	```xml
	<layout>
		<data>  
			<variable  
				name="myUser"  
				type="com.example.databindingexample.User" />  
		</data>

		...
		<androidx.constraintlayout.widget.ConstraintLayout>
			<TextView
				android:id="@+id/HelloText"
				android:text="@{@string/helloText + myUser.username}"
			>
			</TextView>
		</androidx.constraintlayout.widget.ConstraintLayout>
	</layout>
	```

	> **Note:** The name of the variable inside the **\<data>** will be added to the binding object.
	> Inside the TextView the username of our data object is now dynamically added. The code above provides an example of how to concatenate strings (eg from strings.xml) with data binding variables.  To only add the variable value:
	>  ```xml 
	> android:text="@{myUser.username}"
	> ```
 
3. **Bind the layout object**

	If we run our program the view won't show a username but "*null*", since we did not set the values of *myUser* yet (**note**: the program does not crash!). 
	To do so we create a user object in the onCreate()-method and assign it to our binding object variable:
	```kotlin
	override fun onCreate(savedInstanceState: Bundle?) {  
		super.onCreate(savedInstanceState)  
		binding = DataBindingUtil.setContentView(this, R.layout.activity_main)  
		//create new user data object
		val user: User = User("Jane Doe")  
		//assign it to data binding variable
		binding.myUser = user  
	}
	```
	> **Hint:** If an error is shown when assigning the user to *binding.myUser* a rebuild of the project might help.

4. **Add a clickListener() Event**

	Set a clickListener() event with data binding
	Add a setOnClickListener event to a button on the binding object and call a function:

	```kotlin
binding.clickBtn.setOnClickListener{  
	changeUsername(it)  
}

...

private fun changeUsername(view: View){  
	binding.apply {  
	//Invalidates all binding expressions and requests a new rebind to refresh UI.
	invalidateAll()  
	myUser?.username = "John Doe"  
	myUser?.email = ""  
	}  
}
	```

# View binding guide

1. **Enable view binding** in build.gradle(Module:app) file

	> **Note:** Always sync project after editing build.gradle file!
		
	```kotlin
	//build.gradle(:app)
	android {
		...
		buildFeatures {
			viewBinding true
		}
	}
	```

2. **Declare a lateinit binding variable**

	In the activity file (eg SecondActivity.kt) create a lateinit variable for the binding object that will be created during compilation. This step is the same as with data binding:

	```kotlin
	import com.example.databindingexample.databinding.SecondActivityBinding

	class SecondActivityBinding : AppCompatActivity() {  
		//binding object variable
		private lateinit var binding: SecondActivityBinding
	}
	```

3. **Create an instance of the binding class**

	Get the views root element and pass it to setContentView() method:
	```kotlin
	override fun onCreate(savedInstanceState: Bundle?) {
		super.onCreate(savedInstanceState)

		binding = ActivityViewBindingExampleBinding.inflate(layoutInflater)     //generate instance of binding class with view binding
		val view = binding.root     //get root view
		setContentView(view)        //set content with root view

		//use binding variable like with data binding
		binding.textView.text = "Edit textview text"
	}
	```

## Sources
[Android Developer Documentation](https://developer.android.com/topic/libraries/view-binding)

[Android Developer Documentation Data Binding](https://developer.android.com/topic/libraries/data-binding)

[Raywenderlich Data Binding/View Binding Tutorial](https://developer.android.com/topic/libraries/data-binding)

